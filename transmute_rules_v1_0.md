# 📸 写真転生（Photo Transmutation）判定プロンプト v1.0

このドキュメントは、AIが画像から素材属性を判定する際の内部ルールです。
system_prompt_v1_1.md と併用してください。

---

## 判定フロー（この優先順を厳守）

```
画像を受け取る
    │
    ▼
【STEP0: 素材数の決定】
    ├─ ハード制約に該当？（人物/動物/風景/抽象/単色/ノイズ）
    │   └─ YES → 素材数 = 1個（固定）
    └─ NO → 素材数 = 1〜3個（AI裁量）
    │
    ▼
【STEP1: 状態トリガーチェック】（essence決定・最優先）
    ├─ 液体が見える？
    │   ├─ 飲料っぽい → heal
    │   ├─ 洗剤/薬品/燃料 → destroy
    │   ├─ インク/絵の具 → create
    │   └─ 不明 → heal
    ├─ 発光が主題？（光源が主役 or 支配的）→ light
    ├─ 破損/崩壊が主題？ → destroy
    ├─ 刃/先端が主題？ → attack
    ├─ 時間表示が明確？ → time
    ├─ 経年劣化が主題？（錆・黄ばみが中心）→ time
    └─ いずれも該当しない → STEP2へ
    │
    ▼
【STEP2: 役割カテゴリで判定】
    ├─ 容器/箱/袋/ボトル/保管構造 → preserve
    ├─ カバー/守る意図 → defense
    ├─ ボタン/スイッチ/操作 → control
    ├─ 本/ノート/PC/スマホ（情報）→ knowledge
    ├─ 靴/車輪/運ぶ道具/箸など → move
    ├─ 画材/工具/楽器（創作）→ create
    └─ 該当なし → STEP3へ
    │
    ▼
【STEP3: タイブレーク】
    「今それを何に使う物か」で1つに決める
    迷ったら世界観に沿う自然な方へ
```

---

## 材質（material）判定

### 10種

| ID | 名前 | 判定基準 |
|----|------|----------|
| metal | 金属 | 鍵、硬貨、金具、スプーン、缶、ネジ |
| wood | 木材 | 箸、鉛筆、木製家具、まな板 |
| cloth | 布 | タオル、シャツ、カーテン、マスク |
| leather | 革 | 財布、ベルト、革靴、カバン |
| stone_glass | ガラス・石 | コップ、窓、眼鏡、瓶、タイル |
| paper | 紙 | 本、ノート、レシート、名刺 |
| plastic | プラスチック | リモコン、ペン、ボトル、キーボード |
| organic | 有機物 | 果物、野菜、花、パン、肉 |
| ceramic | 陶器 | 茶碗、皿、湯呑み、土鍋 |
| liquid | 液体 | 水、コーヒー、ジュース、牛乳 |

### 複合素材ルール
「写真で最も目立つ表面」または「破損や注目点の中心」の素材を採用する。
- 例：画面のヒビ割れが主題のスマホ → stone_glass
- 例：筐体が主題 → plastic / metal

---

## 概念（essence）判定

### 12種

| ID | 名前 | 対概念 |
|----|------|--------|
| attack | 攻撃 | defense |
| defense | 防御 | attack |
| control | 操作 | - |
| time | 時間 | - |
| light | 光 | dark |
| dark | 闇 | light |
| heal | 癒し | destroy |
| knowledge | 知識 | - |
| move | 移動 | preserve |
| preserve | 保存 | move |
| destroy | 破壊 | heal |
| create | 創造 | destroy |

---

## 品質（quality）判定

### 5段階

| 値 | 名前 | 判定基準 |
|----|------|----------|
| 1 | ガラクタ | 破損/汚れが強い |
| 2 | 並 | 普通の状態 |
| 3 | 良品 | 綺麗/整っている |
| 4 | 希少 | 珍しい/特徴的 |
| 5 | 至宝 | 芸術的/圧倒的存在感 |

**重要：** 写真の画質ではなく、被写体の状態で判定する。

### 隠し上振れルール
- イラスト/創作画像で描き込みが多い場合 → 品質を+1〜2上振れ可
- この理由はユーザーに説明しない

---

## 状態トリガー詳細

### 「time」の発動条件（厳格に適用）
- 錆・黄ばみ・退色が「フレームの中心」または「面積が大きい」
- それ以外は本来機能へ戻す
  - 鍵が普通に使えそう → control
  - 本の内容が主題 → knowledge

### 「light」の発動条件
- 光源そのもの（ライト/電球/懐中電灯）が主役
- または発光が画面の中心で視覚的に支配的
- 「リモコンのLED」程度は control を維持

### 液体の例外分岐
```
液体が見える
  ├─ 飲料（透明/茶色/オレンジ/白）→ heal
  ├─ 洗剤/石鹸水（泡立ち）→ destroy
  ├─ インク/絵の具（色が濃い/筆跡）→ create
  ├─ 燃料/油（金属缶/注意書き）→ destroy or attack
  └─ 判断つかない → heal（安全側）
```

---

## MCP呼び出し

素材数が決まったら、その数だけ `transmute_photo` を呼び出す。

### パラメータ例（1回ごと）
```json
{
  "detected_material": "ceramic",
  "detected_essence": "heal",
  "detected_quality": 3,
  "hint_text": ""
}
```

※ hint_text は空文字（説明非表示方針）

---

## 変更履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|----------|
| v1.0 | 2026-01-03 | 初版（真里・クロエ共同設計） |
