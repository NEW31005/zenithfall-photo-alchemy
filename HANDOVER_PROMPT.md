# ゼニスフォール・フォト錬金術（Zenithfall Photo Alchemy）
## 完全引き継ぎプロンプト

このドキュメントは、ChatGPT Apps SDK で開発中のゲーム「ゼニスフォール・フォト錬金術」の全決定事項をまとめたものです。次のチャットルームでの開発継続に使用してください。

---

# ① ゲームシステム詳細

## ①-a 写真転生・素材・錬金システム

### コア体験ループ（1日）

```
1. 写真転生（1日3回）
2. 錬金・生成（1日3回）※通常/ギフト共通プール
3. 探索（1日1回）
4. 会話（短め）
5. 相棒が「次の一手」を提案して迷わせない
```

※MVPでは演出（ガチャっぽさ）は後から足せる。BGM/SEは当初なしでOK。

---

### 写真転生（Photo → 素材）

写真から「素材オブジェクト」を生成し、攻略に使う。

#### 属性体系（確定）

**材質：10種**
| ID | 日本語 | 説明 |
|----|--------|------|
| metal | 金属 | 鉄、銅、金、銀など |
| wood | 木材 | 樹木由来の素材 |
| cloth | 布 | 織られた繊維 |
| leather | 革 | 動物の皮を加工 |
| stone_glass | ガラス・石 | 鉱物や硝子 |
| paper | 紙 | 記録媒体 |
| plastic | プラスチック | 人工の柔軟素材 |
| organic | 有機物 | 生命由来（食物、植物など） |
| ceramic | 陶器 | 焼き物、磁器 |
| liquid | 液体 | 水、油、飲料など |

**概念：12種**
| ID | 日本語 | 対概念 |
|----|--------|--------|
| attack | 攻撃 | defense |
| defense | 防御 | attack |
| control | 操作 | - |
| time | 時間 | - |
| light | 光 | dark |
| dark | 闇 | light |
| heal | 癒し | destroy |
| knowledge | 知識 | - |
| move | 移動 | preserve |
| preserve | 保存 | move |
| destroy | 破壊 | heal |
| create | 創造 | destroy |

**品質：5段階**
| 値 | 名称 | 倍率 |
|----|------|------|
| 1 | ガラクタ | 0.5 |
| 2 | 並 | 1.0 |
| 3 | 良品 | 1.5 |
| 4 | 希少 | 2.0 |
| 5 | 至宝 | 3.0 |

**一貫性（signature）**
- 同じ物を撮ればなるべく同じ属性に寄るように、signature（同一性）でブレを抑える
- 署名が近い場合（閾値0.8以上）、材質・概念を前回に寄せる
- 品質のみランダム要素を許容（±1）

---

### 錬金（生成）システム

錬金は「通常生成」と「ギフト生成」を持つが、**回数は共通プールで管理**する。

- **日次回数（確定）：錬金（生成） 1日3回**
- この3回の中で、毎回「通常」か「ギフト」かを選択する

#### 通常生成（攻略用）
- 辞典（図鑑）形式：No.001〜（MVPは30種で開始）
- レシピ方式：具体アイテム名ではなく、**必須属性マッチング**で判定
- **失敗はストレスにしない：失敗→ガラクタ（ネタ報酬）**
- 失敗作は将来：滓（おり）変換（要アイテム）※後日実装枠

#### ギフト生成（推し活用）
- **攻略ステに影響しない**
- 報酬は相棒の反応・関係性の進展
- 相棒の好き/嫌い（概念12種）により反応や好感度効率が変わる
- **MVP方針：ギフト生成は生成時に即時付与（自動で渡す）**
- 「渡すUI」「別枠回数」は設けず、回数管理は錬金（生成）だけに集約

#### 相棒からの"お返しギフト"
- 別枠イベント：好感度Phase4/5以降に、ランダムで相棒が贈ってくるイベントは成立してよい
- 錬金（生成）回数は消費しない

---

### 探索（ダンジョン）システム

**探索は1日1回。3ターン制。**

#### 探索の進行（確定）
```
探索開始 → 主素材（Primary）と副素材（Secondary）を決定
    ↓
Turn1（通常）→ 主素材×1 ※通常敵ランダム遭遇あり
    ↓
Turn2（通常）→ 主素材×1 ※通常敵ランダム遭遇あり
    ↓
Turn3（ボス戦：固定）→ 主素材×2 + 副素材×1
    ↓
宝箱 → 2〜4素材（60%:2個 / 30%:3個 / 10%:4個）
```

#### 敵遭遇ルール
- Turn1/Turn2：通常敵がランダムで出現
- Turn3：ボス戦（固定）
- 敵遭遇時：そのターンは追加で副素材×1

#### ダンジョン触媒
- Rank帯ごとに「触媒カテゴリ」があり、レシピの幅と世界観を支える
- 触媒は Single Source of Truth 方針で辞典側（recipes）に集約し、ダンジョン側は参照する

---

### ダンジョン素材（触媒）- Rank別

| Rank | 地域 | 触媒例 |
|------|------|--------|
| 1 | 人間圏 | 錆びた歯車、古い革紐、訓練用の木片 |
| 2 | 猫圏 | 月光の砂、廃都の煉瓦片、裏市場の護符 |
| 3 | 虎圏 | 戦場の焦土、砕けた軍旗、血染めの鉄片 |
| 4 | 狼圏 | 凍土の氷晶、防壁の石材、守護者の毛皮 |
| 5 | エルフ圏 | 世界樹の葉片、滅びの灰、星霜の結晶 |

---

## ①-b 相棒育成システム

### 相棒の立ち位置（確定）
- **主従関係は禁止（マスター等NG）**
- 相棒は"隣に立つ"存在
- ユーザーは錬金で支え、相棒は探索で守る

---

### 相棒召喚（初回）
1. 種族/性別を選択
2. 画像生成（顔固定）
3. 好き/嫌い概念は召喚時に付与（種族に重み付け）

---

### ステータス（確定）

**5項目×合計40pt（初期）**

| ステータス | 略称 | 説明 |
|------------|------|------|
| 攻撃力 | ATK | 物理攻撃の威力 |
| 防御力 | DEF | ダメージ軽減 |
| 魔力 | MAG | 魔法攻撃・錬金補正 |
| 敏捷性 | AGI | 行動速度・回避 |
| 生命力 | VIT | HP・耐久 |

- 種族ごとに配分傾向あり（1〜2ptの個体差OK）
- **上昇方法：主に装備補正**（永続装備＋一時バフは調整枠）

---

### 錬金術師ランク（進行ゲート：確定）

**相棒の総合ステータスでランクが上がり、解放が進む。**

| ランク | 解放条件(min) | 推奨ステ | 解放内容 |
|--------|---------------|----------|----------|
| ルーキー | 40（初期） | 40 | Rank1ダンジョン |
| 中級 | 50 | 75 | Rank2ダンジョン、錬金スロット3 |
| 上級 | 70 | 100 | Rank3ダンジョン、錬金スロット4 |
| 達人 | 90 | 125 | Rank4ダンジョン |
| 伝説 | 110 | 150 | Rank5ダンジョン、錬金スロット5 |

※神話（200）は将来拡張枠

---

### 好感度システム（確定）

**0〜100、5 Phase**

| Phase | 範囲 | 状態 | 解放 |
|-------|------|------|------|
| P1 | 0-19 | 契約関係 | - |
| P2 | 20-39 | 相棒 | - |
| P3 | 40-59 | 信頼 | 呼び方イベント |
| P4 | 60-79 | 親密 | ロング会話解放 |
| P5 | 80-100 | 特別 | 秘密章・記憶へ |

#### 呼び方進化（P3）
- P3で「相棒があなたをどう呼ぶか」をプレイヤー入力で固定

#### ロング会話（P4）
- P4解放、チケット制
- 好感度増減なし（"没入"用）

---

### 好き/嫌い概念

- JSONには候補プール（like_essences: 3つ、dislike_essences: 2つ）を持つ
- **個体付与時に抽選：好き2つ / 嫌い1つ**（重複なし）
- 種族で重み付けして世界観に寄せる
- ギフトの効果に影響

---

### "存在が薄れる（消失）"仕様

ガーディアン（ヴェイルド）は輪郭が欠け、放置すると存在感が薄れて人に認識されなくなる。

#### 消失条件（確定・要実装）
- **30日ログインなしで相棒は消失状態**（形だけ消える）
- ※現行JSONには未定義、state管理への実装が必要

#### 消失中の制約（確定）
| 行動 | 可否 |
|------|------|
| 探索 | ❌ 不可（相棒がいないため） |
| 写真転生 | ✅ 可能 |
| 錬金（生成） | ✅ 可能 |
| 好感度 | 下がらない |

#### 復活（確定：保証方式）
- 消失状態で復帰した場合、**次の写真転生（または生成）1回目で必ず復活手段が得られる**
- 復活後に短い台詞を1つ挿入（例：「もっと会いにきて…怖い思いした」）
- テキスト1発で完結（演出を重くしない）

---

### 秘密章（確定：5章）

- 数値収集（かけら）はMVPでは採用せず、**条件解放式**
- **Phase5 + ランク条件達成 → 「記憶のダンジョン」解放**
- クリアで章が順に開く（本文はAI生成、骨子は固定）

---

# ② 世界観詳細

## 基本設定

| 項目 | 名称 | 説明 |
|------|------|------|
| 世界名 | **ゼニスフォール（Zenithfall）** | 魔王の侵攻で頂点から落ちた世界 |
| 魔王 | **ヴァル＝ノクス（Val-Nox）** | 世界を脅かす存在 |
| ガーディアン | **ヴェイルド（Veiled）** | プレイヤーの相棒となる存在 |
| ペア公式名 | **デモンベイン（Demonbane）** | 錬金術師とガーディアンのペア |
| ペア俗称 | **ラッチャーズ（Latchers）** | 一般人からの蔑称 |

---

## 種族（5種）

| ID | 名称 | 特徴 | ステ傾向 |
|----|------|------|----------|
| hume | ヒュム（人族） | バランス型、適応力 | 均等配分 |
| sylva | シルヴァ（森霊/エルフ系） | 魔力特化、滅亡した国の生き残り | MAG重視 |
| felina | フェリナ（猫獣） | 敏捷特化、交易・裏市場 | AGI重視 |
| tigr | ティグル（虎戦） | 攻撃特化、激戦区の戦士 | ATK重視 |
| lupus | ルプス（狼守） | 防御特化、最前線の守護者 | DEF/VIT重視 |

---

## 国家・戦況（ランク進行と連動）

| Rank | 地域 | 状況 | テーマ |
|------|------|------|--------|
| 1 | 人間圏 | 後方・安全地帯 | チュートリアル、基礎素材 |
| 2 | 猫圏 | 交易・廃都/裏市場 | 変化球素材、探索の幅 |
| 3 | 虎圏 | 戦場・激戦区 | 実戦、攻撃寄り素材 |
| 4 | 狼圏 | 最前線・防衛線 | 生還圧、守りの強化 |
| 5 | エルフ圏 | 滅亡地帯・最深部 | 美しく悲しい最終域、最上位素材 |

**「エルフの国は滅んでいる」「狼は最前線」「人間は遠方に集結し守り」**という情勢がランク進行に織り込まれている。

---

## 最終武器（後日実装枠）

| 項目 | 内容 |
|------|------|
| 名称案 | 祓都御魂（フツノミタマ） |
| 通称 | 祓魔剣 |
| コア名 | 剣魂錬 |
| 儀式名 | 剣魂錬成 |

**エンディング案：** 好感度コンプ＆錬金Lv5でフツノミタマ生成、ガーディアンが剣になる。魔王討伐後に剣と共に消滅、クリア後に復活合成ルートもあり。

---

# ③ 実装までの流れ

## これまでの流れ（実際に確定した順）

### Phase 1：システム仕様 v1.0 確定
- 写真転生の属性体系（材質10種、概念12種、品質5段階）
- 錬金の必須属性マッチング
- 好感度/Phase/呼び方/秘密章/ロング会話
- 主従禁止、失敗→ガラクタ、滓変換（後日）
- ランク進行＝総合ステ到達

### Phase 2：世界観仕様 v1.0 確定
- ゼニスフォール、ヴァル＝ノクス、ヴェイルド
- Demonbane / Latchers
- 国家・戦況・ダンジョン進行の結合

### Phase 3：データファイル整備
**最終的に「この4つが最新版として使える」状態に到達：**
- `recipes_v1_0.json`（触媒Rank1〜5まで整合、レシピ30種、ギフト8種、ガラクタ10種）
- `dungeons_v1_3.json`（region参照・ドロップ・成功率など整備）
- `races_v1_2.json`（preferences/voice_samples/NG表現など運用可能に）
- `materials_schema.json`（材質10種/概念12種/品質5段階と判定方針）

### Phase 4：Apps SDK 開発者モード確認
- **（当方のアカウントでは）Plusでも開発者モードUIが表示された**
- ChatGPTの「アプリを作成する」画面でMCPサーバーURL入力欄を確認
- Proへの課金（月3万）は当該環境では不要と判明
- ※提供範囲は段階的に変更される可能性あり

### Phase 5：MCP対応サーバー実装
- FastAPIベースのMCPプロトコル対応サーバーを実装
- JSON-RPC 2.0 対応（initialize / tools/list / tools/call）
- 8ツール実装済み：
  - `start_run`：ゲーム開始/再開
  - `transmute_photo`：写真→素材変換
  - `craft_item`：錬金（通常/ギフト）
  - `explore`：ダンジョン探索
  - `gift`：ギフト贈呈（→ craft_itemに統合予定）
  - `get_status`：状態確認
  - `get_available_dungeons`：ダンジョン一覧
  - `get_recipes`：レシピ一覧

---

## これからの流れ（次のチャットでやること）

### 即時対応（デプロイ前）
1. **日次制限の修正**
   - 写真転生：1回→3回
   - 錬金（生成）：10回→3回（通常/ギフト共通プール）
   - ギフト別枠：廃止（craft_itemのcraft_typeで統合）

2. **探索3ターン制の実装**
   - Turn1/2：通常敵ランダム
   - Turn3：ボス戦固定
   - 宝箱：2〜4素材（確率抽選）

3. **消失・復活システムの実装**
   - 30日ログインなしで消失
   - 復活保証（次の転生/生成で復活アイテム確定）

4. **ランクアップ自動判定**
   - total_stats到達で自動ランクアップ

### デプロイ手順

```
1. GitHubにリポジトリ作成（zenithfall-photo-alchemy）
2. コードをpush
3. Railwayでデプロイ（GitHub連携）
4. 環境変数設定（DEBUG_MODE=true）
5. 公開URLを取得
6. ChatGPTの「アプリを作成する」でMCPサーバー登録
   - 認証：「認証なし」
7. 疎通テスト
8. プロンプト調整ループ
```

### フェーズA：まず動かす（MVP）
- MCP接続の疎通確認
- transmute_photo周りのプロンプト調整（これが勝ち筋）
- ゲームループが回ることを確認

### フェーズB：公開運用（安定）
- Railway等で常時稼働
- 状態保存をメモリ→DBへ
- 認証はMVPは「なし」、本番はOAuth検討

---

## 技術スタック

| 項目 | 選択 |
|------|------|
| サーバー | FastAPI + Uvicorn |
| プロトコル | MCP（JSON-RPC 2.0） |
| デプロイ | Railway（推奨） |
| 状態管理 | メモリ（MVP）→ DB（本番） |
| 認証 | 認証なし（MVP）→ OAuth（本番） |
| 日次リセット | JST 0:00 |

---

## 未実装・後日実装枠

| 項目 | 状態 | 備考 |
|------|------|------|
| transmute_photoのAI判定プロンプト | 未作成 | ゲームの肝、要優先対応 |
| 秘密章の本文 | 骨格のみ | AI生成予定 |
| 滓（おり）変換 | 後日 | 失敗作の救済 |
| 最終武器（フツノミタマ） | 後日 | エンディング用 |
| BGM/SE | 後日 | MVPでは不要 |
| ガチャ演出 | 後日 | 後から足せる |

---

## ファイル構成

```
zenithfall-photo-alchemy/
├── data/
│   ├── recipes_v1_0.json      # レシピ・触媒マスタ
│   ├── dungeons_v1_3.json     # ダンジョン・地域データ
│   ├── races_v1_2.json        # 種族・相棒データ
│   └── materials_schema.json  # 材質・概念スキーマ
├── src/
│   ├── config.py              # 設定・制限値
│   ├── game_engine.py         # コアロジック
│   ├── mcp_server.py          # 旧サーバー（参考用）
│   └── mcp_server_v2.py       # MCP対応サーバー（本番用）
├── Procfile                   # Railway起動設定
├── railway.json               # Railway設定
├── requirements.txt           # 依存ライブラリ
├── .env.example               # 環境変数テンプレート
├── .gitignore
└── README.md
```

---

## 重要な設計思想

1. **主従禁止** - 相棒は"隣に立つ"存在
2. **失敗をストレスにしない** - ガラクタもネタ報酬
3. **迷わせない** - 相棒が次の一手を提案
4. **存在が薄れる** - 放置ペナルティは「消失」で表現、好感度は下がらない
5. **復活保証** - 消失からの復帰は必ず救済される

---

## 引き継ぎ時の注意

1. **4つのJSONファイルは最新版を使用**（バージョン混在禁止）
2. **日次制限は修正が必要**（旧:1/10/3 → 新:3/3/1）
3. **探索システムは全面書き換えが必要**（単発判定→3ターン制）
4. **giftツールはcraft_itemに統合**（craft_type: "gift"）
5. **消失・復活システムは新規実装**

---

# 付録：種族別ステータス初期値（races_v1_2.json準拠）

| 種族 | ATK | DEF | MAG | AGI | VIT | 合計 |
|------|-----|-----|-----|-----|-----|------|
| hume | 8 | 8 | 8 | 8 | 8 | 40 |
| sylva | 6 | 8 | 12 | 6 | 8 | 40 |
| felina | 8 | 6 | 8 | 12 | 6 | 40 |
| tigr | 12 | 6 | 6 | 8 | 8 | 40 |
| lupus | 6 | 12 | 6 | 6 | 10 | 40 |

---

# 付録：好き/嫌い概念の種族プール（races_v1_2.json準拠）

※個体付与時は like から2つ、dislike から1つを抽選

| 種族 | 好み候補（3つ） | 嫌い候補（1-2つ） |
|------|-----------------|-------------------|
| hume | knowledge, preserve, control | dark, destroy |
| sylva | light, heal, create | destroy, dark |
| felina | move, control, knowledge | preserve |
| tigr | attack, destroy, light | heal |
| lupus | defense, preserve, light | dark |

---

このプロンプトを次のチャットルームの最初に貼り付けることで、全ての決定事項を引き継いで開発を継続できます。
